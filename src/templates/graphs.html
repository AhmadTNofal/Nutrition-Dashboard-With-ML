<!DOCTYPE html>
<html class="{{ dark_mode }}">

  <head>
    <title>Graphs</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Main.css') }}" />
    <style>
      .modal {
        display: none;
        position: fixed;
        z-index: 2;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, 0.4);
      }
  
      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        height: 80%;
        overflow: auto;
      }
  
      .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
  
      .close:hover,
      .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }
  
      .modal-content canvas {
        width: 100%;
        height: auto;
      }
  
      .graph-container {
        cursor: pointer; /* Indicates that the graphs are clickable */
      }
    </style>
  </head>
  
  <body>
    <script src="main.js"></script>
    <div class="app-container">
      <div class="app-header">
        <div class="app-header-left">
          <span class="app-icon"></span>
          <p class="app-name">DASHBOARD</p>
        </div>
        <div class="app-header-right">
          <button class="mode-switch" title="Switch Theme">
            <svg
              class="moon"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              width="24"
              height="24"
              viewBox="0 0 24 24"
            >
              <defs></defs>
              <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="app-content">
        <div class="app-sidebar">
          <a href="index.html" class="app-sidebar-link">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-home"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
          </a>
          <a href="graphs.html" class="app-sidebar-link active">
            <svg
              class="link-icon"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              class="feather feather-pie-chart"
              viewBox="0 0 24 24"
            >
              <defs />
              <path
                d="M21.21 15.89A10 10 0 118 2.83M22 12A10 10 0 0012 2v10z"
              />
            </svg>
          </a>

          <a href="upload.html" class="app-sidebar-link">
            <svg  class="link-icon"
            width="24"
            height="24"
            fill="currentColor"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="0.3"
            viewBox="0 0 16 16"
            >
              <defs />
              <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
              <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>
            </svg>
          </a>
          
          <a href="help.html" class="app-sidebar-link">
            <svg  class="link-icon"
            width="24"
            height="24"
            fill="currentColor"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="0.3"
            viewBox="0 0 16 16"
            >
              <defs />
              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
              <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
            </svg>
            </svg>
          </a>
        </div>
        <div class="projects-section">
          <div class="projects-section-header">
            <p>GRAPHS</p>
            <p> Current Patients: {{ sum }} </p>
            <p> Need Referral: {{ count }} </p>
            <p class="time">{{ today }}</p>
          </div>


            
              <div class="graphs-grid">
                <div class="graph-container pie-chart-container">
                  <canvas id="pieChart"></canvas>
                </div>
                <div class="graph-container histogram-container">
                  <canvas id="histogram"></canvas>
                </div>
                <div class="graph-container complete-incomplete-container">
                  <canvas id="completeIncompleteChart"></canvas>
                </div>
                <div class="graph-container tidal-volume-container">
                  <canvas id="tidalVolumeChart"></canvas>
                </div>
              </div>
              

              <div id="myModal" class="modal">
                <div class="modal-content">
                  <span class="close">&times;</span>
                  <canvas id="modalCanvas"></canvas>
                </div>
              </div>



    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Parse data for charts
        var pieData = JSON.parse('{{ pie_data | safe }}');
        var histogramData = JSON.parse('{{ histogram_data | safe }}');
  
        // Initialize the pie chart
        var ctxPie = document.getElementById('pieChart').getContext('2d');
        var pieChart = new Chart(ctxPie, {
          type: 'pie',
          data: {
            labels: ['Needs Referral', 'No Referral'],
            datasets: [{
              data: pieData,
              backgroundColor: ['red', 'green'],
            }]
          }
        });
  
        // Initialize the histogram
        var ctxHistogram = document.getElementById('histogram').getContext('2d');
        var histogramChart = new Chart(ctxHistogram, {
          type: 'bar',
          data: {
            labels: histogramData.map((_, i) => `Patient ${i + 1}`),
            datasets: [{
              label: 'Confidence Score (%)',
              data: histogramData,
              backgroundColor: 'blue',
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                responsive: true,
                maintainAspectRatio: false
              }
            }
          }
        });
  
        // Modal functionality
        var modal = document.getElementById("myModal");
        var span = document.getElementsByClassName("close")[0];
    
        // Function to show the modal with the given chart
        function showModal(chart) {
          modal.style.display = "block";
          var modalCtx = document.getElementById("modalCanvas").getContext('2d');
    
          // Clear previous chart from modal if it exists
          modalCtx.clearRect(0, 0, modalCanvas.width, modalCanvas.height);
    
          // Copy the chart into the modal canvas
          new Chart(modalCtx, {
            type: chart.config.type,
            data: chart.data,
            options: Object.assign({}, chart.options, { 
              responsive: true,
              maintainAspectRatio: true 
            })
          });
        }
    
        // Attach onclick events to graphs
        var pieCanvas = document.getElementById('pieChart');
        var histogramCanvas = document.getElementById('histogram');
        
        pieCanvas.onclick = function() {
          showModal(pieChart);
        };
    
        histogramCanvas.onclick = function() {
          showModal(histogramChart);
        };
    
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
          modal.style.display = "none";
        };
    
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        };
      });

      document.addEventListener('DOMContentLoaded', function () {
        var ctxCompleteIncomplete = document.getElementById('completeIncompleteChart').getContext('2d');
        var completeIncompleteChart = new Chart(ctxCompleteIncomplete, {
            type: 'bar',
            data: {
                labels: ['Complete Data', 'Incomplete Data'],
                datasets: [{
                    label: 'Data Completeness',
                    data: JSON.parse('{{ complete_data | safe }}'),
                    backgroundColor: ['green', 'red'],
                }]
            }
        });
    
        var ctxTidalVolume = document.getElementById('tidalVolumeChart').getContext('2d');
        var tidalVolumeChart = new Chart(ctxTidalVolume, {
            type: 'boxplot',  // Ensure you have a boxplot type available or use a compatible type
            data: {
                labels: ['Actual Tidal Volume', 'KG-based Tidal Volume'],
                datasets: [{
                    label: 'Tidal Volume Distribution',
                    data: JSON.parse('{{ tidal_volume_data | safe }}'),
                    backgroundColor: 'blue',
                }]
            }
        });
    });

    </script>
  </body>
</html>
